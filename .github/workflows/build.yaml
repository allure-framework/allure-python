name: allure python

on: [push]

jobs:
#  static-check:
#    runs-on: ubuntu-latest
#    strategy:
#      matrix:
#        package: [
##          allure-python-commons,
#          allure-behave,
#          allure-pytest,
#          allure-robotframework
#        ]
#        python-version: [3.7]
#
#    steps:
#    - uses: actions/checkout@v2
#    - name: Set up Python ${{ matrix.python-version }}
#      uses: actions/setup-python@v1
#      with:
#        python-version: ${{ matrix.python-version }}
#    - name: Install Tox
#      run: pip install tox
#    - name: Test ${{ matrix.package }}
#      run: tox -e static-check -c ${{ matrix.package }}/tox.ini
#
#  build-commons:
#    needs: static-check
#    runs-on: ubuntu-latest
#    strategy:
#      matrix:
#        package: [allure-python-commons-test, allure-python-commons]
#        python-version: [3.6, 3.7]
#
#    steps:
#    - uses: actions/checkout@v2
#    - name: Set up Python ${{ matrix.python-version }}
#      uses: actions/setup-python@v1
#      with:
#        python-version: ${{ matrix.python-version }}
#    - name: Install Tox
#      run: pip install tox
#    - name: Test ${{ matrix.package }}
#      run: tox -e py`echo ${{ matrix.python-version }} | sed 's/\.//g'` -c ${{ matrix.package }}/tox.ini

  build-plugins:
#    needs: build-commons
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package: [allure-behave, allure-pytest, allure-robotframework]
        python-version: [3.6, 3.7]
        include:
          - python-version: 3.7
            additional-env: static-check

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install Tox
      run: pip install tox
    - name: Prepare allure-python-commons-test
      run: tox -e dry-run -c allure-python-commons-test/tox.ini
    - name: Prepare allure-python-commons
      run: tox -e dry-run -c allure-python-commons/tox.ini
    - name: Static check ${{ matrix.package }}
      if: ${{ matrix.package}}
      run: tox -e static-check -c ${{ matrix.package }}/tox.ini
    - name: Test ${{ matrix.package }}
      run: tox -e py`echo ${{ matrix.python-version }} | sed 's/\.//g'` -c ${{ matrix.package }}/tox.ini
